datasource db {
    provider = "postgresql"
}

generator client {
    provider = "prisma-client-js"
    output = "../app/_data/"
}

enum Role {
    USER
    MODERATOR
    ADMIN
}

enum UserStatus {
    ACTIVE
    SUSPENDED
    BANNED
}

enum EventStatus {
    ACTIVE
    HIDDEN
    DELETED
}

enum Tables {
    USER
    EVENT
    EVENTTABLE
}

model Account {
  id String @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  accountId String
  providerId String
  userId String
  accessToken String?
  refreshToken String?
  idToken String?
  accessTokenExpiresAt DateTime?
  refreshTokenExpiresAt DateTime?
  scope String?
  password String?
  user User @relation(fields: [userId], references: [id])

  @@index([providerId, accountId])
}


model Session {
  id String @id @default(cuid())
  token String @unique
  userId String
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  user User @relation(fields: [userId], references: [id])
}

model Verification {
  id String @id @default(cuid())
  identifier String
  value String @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
    id String @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name String
    email String? @unique
    emailVerified Boolean? @default(true)
    image String?
    platformId String @unique
    role Role @default(USER)
    status UserStatus @default(ACTIVE)
    events Event[] @relation("creator")
    editorOf Event[] @relation("editors")
    activity ChangeHistory[]
    sessions Session[]
    accounts Account[]
}

model Event {
    id String @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name String @unique @db.VarChar(32)
    title String @db.VarChar(64)
    description String @db.VarChar(200)
    visibility EventStatus @default(ACTIVE)
    creator User @relation(fields: [creatorId], references: [id], name: "creator")
    creatorId String
    editors User[] @relation(name: "editors")
    schedules Timetable[]
}

model Timetable {
    id String @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    stub String @db.VarChar(32)
    title String @db.VarChar(64)
    channel String @db.VarChar(25)
    website String @db.VarChar(64)
    startDate DateTime @default(now())
    transitionTime Int
    delay Int
    extraColumns Json
    event Event @relation(fields: [eventId], references: [id])
    eventId String
    entries TimetableEntry[]
}

model TimetableEntry {
    id String @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    estimate Int
    name String @db.VarChar(50)
    extraData Json
    timetable Timetable @relation(fields: [timetableId], references: [id])
    timetableId String
}

model ChangeHistory {
    id String @id @default(uuid())
    createdAt DateTime @default(now())
    instigator User @relation(fields: [instigatorId], references: [id])
    instigatorId String
    affectedTable Tables
    payload Json
}